<!DOCTYPE html>  
<html lang="en">  
  
<head>  
    <meta charset="UTF-8">  
    <title>websocket</title>  
</head>  
  
<body>  
    <div>  
        <button id='send'> 获取打印机列表</button>  
		<button id='dayin'> 打印</button>
		<select id="dev_name">
		
		</select>
    </div>  
</body>  
<script>  
var dev_name = document.getElementById('dev_name');

var socket = new WebSocket('ws://127.0.0.1:8008');  
socket.onopen = function(event) {  
    console.log('连接');  
};  
  
socket.onmessage = function(event) {  
    var content = event.data;
	var response = JSON.parse(content);
	console.log(response);
    if (response.method == 'getPrinterList') { 
		var printers = response.data;
        var option = '';
		for(var key in printers ){
			option += '<option value="'+printers[key]+'">'+printers[key]+'</option>';
		}
		
		dev_name.innerHTML = option;
    }  
};  

var send = document.getElementById('send');  
send.addEventListener('click', function() {  
    var content = JSON.stringify({"method":"getPrinterList","params":[],"template_id":"123","data":{"title":"aaaaaaa","body":"ggggggg"}});  
    socket.send(content);  
    alert('发送');  
  
});  

var dayin = document.getElementById('dayin');  
dayin.addEventListener('click', function() { 
	var printer_name = dev_name.value;
	alert(printer_name);
	
	var send_data = {"method":"dayin","params":[],"template_id":"123","data":{"title":"aaaaaaa","body":"ggggggg"}};
	send_data['params']['printer'] = printer_name;
	
    var content = JSON.stringify(send_data);  
    socket.send(content);  
    //alert('发送');  
  
});
</script>  
  
</html> 